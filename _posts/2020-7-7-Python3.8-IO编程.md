---
layout:     post
title:      python3.8 IO编程
subtitle:   Python IO
date:       2020-7-7
author:     ErYueSheng
header-img: img/post-sample-image.jpg
catalog:    true
tags:
    - python
    - IO编程
---

IO即为输入输出，输入指从外部输入（或叫读取）至内存，输出指将内存中的数据输出（或叫写入）值外部空间。

同步IO指CPU等待IO处理完成，再接着向下执行。异步IO指CPU不等待IO处理完成，直接执行后续代码。异步IO性能明显高于同步IO，但是其复杂度同样高出同步IO几个数量级。这里只讨论同步IO。

## 文件读写

文件读写时最常见的IO操作，Python内置了读写文件的函数。用法同C语言兼容。

#### 打开文件

读写文件之前应该打开文件

Python使用内置的open函数打开一个文件，需要传入的参数为文件名和权限标识符

    f = open('test.txt', 'r')

如果文件不存在，则会抛出IOError。第二个参数权限标识符，可以有的为'r'(read)、'w'(write)、'b'（二进制）、'a'（追加），四者可以随意组合，似实际情况而定。

文件打开默认使用utf-8编码，如果读取非utf-8格式的文本文件，需要传入encoding参数。

    f = open('gbk.txt', 'r', encoding='gbk')

对于一些编码不规范的文件，可能会抛出UnicodeDecodeError，通常是由于一些非法字符引起的，可以直接忽略

    f = open('gbk.txt', 'r', encoding='gbk', errors='ignore')

#### 读取文件内容

如果文件成功打开，则可以使用read方法一次性读取文件所有内容（要有'r')

    f.read()

对于文件操作，很多时候为了避免程序报错，使程序终止，文件无法被关闭，通常需要使用try...finally...

    try:
        f = open('/path/to/file', 'r')
        print(f.read())
    finally:
        if f:
            f.close()

read()函数会一次性读取全部文件内容，可以传入参数read(size)来完成对size个字节的内容的读取，多次调用读取完整个文件内容。也可以使用readline()函数读取一行文件内容。

#### 写入文件内容

使用write(内容)函数来写入文件（open时要有'w'）

    f = open('/Users/michael/test.txt', 'w')
    f.write('Hello, world!')
    f.close()

打开时可以指定写入的编码。也可以用'a'来实现追加写。

### 关闭文件

打开了文件一定要关闭。使用try...finally...或者with来挖成这一项操作。

## StringIO和BytesIO

#### StringIO

StringIO就是内存中的一个buffer，可以用来存储、读写str数据。可以使用一个字符串来初始话StringIO

    from io import StringIO
    f = StringIO('lalala\n')
    print(f.write('hello'))
    print(f.write(' '))
    f.write('world')
    print(f.getvalue())

write()函数写入内容返回写入字符个数，getvalue()函数读取写入后的str，还可以使用readline()函数

#### BytesIO

StringIO只能操作字符串，对于二进制数据，使用BytesIO来实现读写操作。

    from io import BytesIO
    f = BytesIO()
    f.write('中文'.encode('utf-8'))
    print(f.getvalue())

## 操作文件和目录

对于文件和目录的操作，需要操作系统提供的命令来完成

    import os
    print(os.name)

#### 环境变量

操作系统中定义的环境变量全部保存在os.environ变量中。可以使用get('key')查看某个环境变量的值。

    print(os.environ)
    print(os.environ.get('PATH'))
    print(os.environ.get('x', '负一'))

#### 操作文件和目录

os.path.abspath('.')返回当前路径的绝对路径
os.path.join('\Users', 'testdir')将目录表示出来，只是将两个名称拼接起来，非要搞个函数的原因在于Windows和linux系统路径分隔符不一样。
os.mkdir('\Users\testdir')创建一个目录
os.rmdir('\Users\testdir')删除一个目录
os.path.split()函数，这样可以把一个路径拆分为两部分，后一部分总是最后级别的目录或文件名：
os.path.splitext()可以直接让你得到文件扩展名
os.rename('test.txt', 'test.py')对文件重命名
os.remove('test.py')删除文件
os.listdir('.')列出当前路径的所有文件和文件夹
os.path.isdir()判断是否是文件夹
os.path.isfile()判断是否是一个文件

>20200707
